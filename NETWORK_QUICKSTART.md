# Network Setup - Quick Start üöÄ

Deploy Indy Sim to your Arduino Q (or any remote device) and access it from another machine on your network.

## Quick Setup (3 commands)

On your Arduino Q:

```bash
# 1. Run the setup script (auto-detects IP)
./setup-network.sh

# 2. Start the containers
docker-compose -f docker-compose.network.yml up --build

# 3. Access from your browser (use the IP shown by setup script)
# http://<ARDUINO_IP>:5173
```

That's it! üéâ

## What the Setup Script Does

1. Auto-detects your Arduino Q's IP address
2. Backs up your original files (if not already backed up)
3. Creates `frontend/.env.network` with your IP
4. Activates network-enabled backend and frontend

## Accessing the Simulation

From any device on your home network, open a browser to:
```
http://<YOUR_ARDUINO_IP>:5173
```

Example: `http://192.168.1.50:5173`

## Reverting Back

To go back to the localhost configuration:

```bash
./restore-localhost.sh
docker-compose up
```

## Troubleshooting

### Can't Connect?

1. **Check if containers are running:**
   ```bash
   docker ps
   ```

2. **Test backend from your laptop:**
   ```bash
   curl http://<ARDUINO_IP>:3001/health
   ```
   
   Should return: `{"status":"ok","timestamp":...}`

3. **Check firewall (if enabled):**
   ```bash
   sudo ufw allow 3001
   sudo ufw allow 5173
   ```

4. **View logs:**
   ```bash
   docker-compose -f docker-compose.network.yml logs -f
   ```

5. **Try from Arduino Q itself first:**
   - Open browser on Arduino Q
   - Go to `http://localhost:5173`
   - If this works but remote doesn't, it's a network/firewall issue

### WebSocket Connection Fails

Check browser console (F12) for errors. The frontend will show which backend URL it's trying to connect to on the loading screen.

### Performance Issues

The Arduino Q might struggle with the default 30 updates/second. Create a `.env` file in the backend directory:

```bash
cat > backend/.env << EOF
UPDATE_FREQUENCY=10
TOTAL_LAPS=30
EOF
```

Then restart:
```bash
docker-compose -f docker-compose.network.yml restart
```

## Files Created

- `docker-compose.network.yml` - Network-enabled compose file
- `backend/src/server.network.js` - Backend with CORS support
- `frontend/src/App.network.jsx` - Frontend with configurable backend URL
- `frontend/.env.network` - Generated by setup script
- `setup-network.sh` - Automated setup
- `restore-localhost.sh` - Revert to original config

## Manual Setup (if you prefer)

If you don't want to use the scripts:

1. **Find your IP:**
   ```bash
   hostname -I
   ```

2. **Create frontend/.env.network:**
   ```bash
   echo "VITE_BACKEND_URL=http://<YOUR_IP>:3001" > frontend/.env.network
   ```

3. **Activate network files:**
   ```bash
   cp backend/src/server.js backend/src/server.original.js
   cp backend/src/server.network.js backend/src/server.js
   
   cp frontend/src/App.jsx frontend/src/App.original.jsx
   cp frontend/src/App.network.jsx frontend/src/App.jsx
   ```

4. **Start:**
   ```bash
   docker-compose -f docker-compose.network.yml up --build
   ```

## Security Note

‚ö†Ô∏è This configuration allows connections from any device on your network (`CORS_ORIGIN=*`). 

**Safe for:** Home networks, development, testing
**NOT safe for:** Public networks, production

## Need Help?

See the detailed guide in `NETWORK_SETUP.md` for more information and advanced troubleshooting.

